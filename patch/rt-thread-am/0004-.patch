From df4a674b409e473c2a2b181a5fedcb67e1396246 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?=E7=8E=8B=E5=AD=90=E5=8D=BF?= <wang_ph@sjtu.edu.cn>
Date: Sun, 3 Aug 2025 20:50:46 +0800
Subject: [PATCH 4/4] =?UTF-8?q?=E5=8F=96=E6=B6=88=E6=9C=89=E4=B8=B2?=
 =?UTF-8?q?=E5=8F=A3=E8=BE=93=E5=85=A5=E6=97=B6=E7=9A=84=E5=86=85=E7=BD=AE?=
 =?UTF-8?q?=E5=91=BD=E4=BB=A4?=
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

---
 bsp/abstract-machine/src/uart.c | 5 +++--
 1 file changed, 3 insertions(+), 2 deletions(-)

diff --git a/bsp/abstract-machine/src/uart.c b/bsp/abstract-machine/src/uart.c
index 714be39f0..6c24c061b 100644
--- a/bsp/abstract-machine/src/uart.c
+++ b/bsp/abstract-machine/src/uart.c
@@ -39,8 +39,9 @@ static int _uart_putc(struct rt_serial_device *serial, char c) {
 
 static int _uart_getc(struct rt_serial_device *serial) {
   static const char *p = "help\ndate\nversion\nfree\nps\npwd\nls\nmemtrace\nmemcheck\nutest_list\n";
-	if (*p == '\0') halt(0);
-  return (*p != '\0' ? *(p ++) : (io_read(AM_UART_CONFIG).present ? io_read(AM_UART_RX).data : -1));
+	if (io_read(AM_UART_CONFIG).present)
+		return io_read(AM_UART_RX).data;
+  return (*p != '\0' ? *(p ++) : -1);
 }
 
 const struct rt_uart_ops _uart_ops = {
-- 
2.34.1

